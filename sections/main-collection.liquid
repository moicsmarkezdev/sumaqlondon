{%- liquid
  assign active_values_count = 0

  for filter in collection.filters
    if filter.type == 'price_range'
      if filter.max_value.value != blank or filter.min_value.value != blank
        assign active_values_count = active_values_count | plus: 1
      endif
    else
      assign active_values_count = active_values_count | plus: filter.active_values.size
    endif
  endfor

  if section.settings.quick_links_menu.links.size > 0 or section.settings.show_filters and collection.filters.size > 0
    assign show_filters = true
  else
    assign show_filters = false
  endif
-%}

<style>
  .filter-group {
    margin-bottom: 1rem;
  }

  .filter-dropdown,
  .filter-input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 1rem;
  }

  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .collection-toolbar {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .collection-toolbar__button {
    background-color: #f5f5f5;
    border: 1px solid #ddd;
    padding: 0.5rem 1rem;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    font-size: 0.9rem;
  }

  .product-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
  }

  .product-card {
    border: 1px solid #ddd;
    padding: 1rem;
    border-radius: 5px;
    text-align: center;
  }
</style>

<div class="color-scheme color-scheme--{{ section.settings.color_scheme.id }}">
  <div class="container">
    <div class="v-stack gap-6 sm:gap-12">
      {%- if collection.all_products_count == 0 -%}
        <div class="empty-state">
          <div class="prose">
            <h1 class="h4">{{ collection.title }}</h1>
            <p>{{ 'collection.general.empty_collection' | t }}</p>

            {%- assign button_content = 'collection.general.continue_shopping' | t -%}
            {%- render 'button', href: routes.all_products_collection_url, size: 'xl', content: button_content -%}
          </div>
        </div>
      {%- else -%}

        <!-- Barra de Filtros -->
        <div class="filter-bar">
          <!-- Filtro de Categorías -->
          <div class="filter-group">
            <label for="category-filter">{{ 'Category' | t }}</label>
            <select id="category-filter" class="filter-dropdown" onchange="location = this.value;">
              <option value="">{{ 'All Categories' | t }}</option>
              {% for tag in collection.all_tags %}
                <option value="{{ tag | link_to_tag }}">{{ tag }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Filtro de Colecciones -->
          <div class="filter-group">
            <label for="collection-filter">{{ 'Collection' | t }}</label>
            <select id="collection-filter" class="filter-dropdown">
              <option value="">{{ 'All Collections' | t }}</option>
              {% for collection in all_collections %}
                <option value="{{ collection.url }}">{{ collection.title }}</option>
              {% endfor %}
            </select>
          </div>

          <!-- Filtro de Tamaño -->
          <div class="filter-group">
            <label for="size-filter">{{ 'Size' | t }}</label>
            <select id="size-filter" class="filter-dropdown">
              <option value="">{{ 'All Sizes' | t }}</option>
              <option value="small">Small</option>
              <option value="medium">Medium</option>
              <option value="large">Large</option>
            </select>
          </div>

          <!-- Filtro de Color -->
          <div class="filter-group">
            <label for="color-filter">{{ 'Color' | t }}</label>
            <select id="color-filter" class="filter-dropdown">
              <option value="">{{ 'All Colors' | t }}</option>
              <option value="red">Red</option>
              <option value="blue">Blue</option>
              <option value="green">Green</option>
            </select>
          </div>

          <!-- Filtro de Precio -->
          <div class="filter-group">
            <label for="price-filter">{{ 'Price' | t }}</label>
            <input type="range" id="price-filter" class="filter-input" min="0" max="5000" step="50" />
          </div>
        </div>

        <!-- Lista de Productos -->
        <div class="collection__main">
          <product-list id="product-list-{{ section.id }}" class="product-list">
            {%- for product in collection.products -%}
              <div class="product-card">
                {%- render 'product-card', product: product, position: forloop.index -%}
              </div>
            {%- endfor -%}
          </product-list>

          {%- render 'pagination', paginate: paginate, facet: true -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Main Collection",
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "show_filters",
      "label": "Show Filters",
      "default": true
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per Page",
      "min": 8,
      "max": 50,
      "step": 1,
      "default": 48
    }
  ]
}
{% endschema %}
